+++
date = '2021-02-05T17:09:00+08:00'
draft = false
title = 'Erase-Removeæƒ¯ç”¨æ³•'
tags = ['C++', 'STL']
toc = true
+++

çœ‹åˆ°ã€ŠEffective STLã€‹æ¡æ¬¾ 9 çš„æ—¶å€™æƒ³åˆ°äº†æˆ‘ä»¥å‰å¤ä¹ çš„â€œå¦‚ä½•æ­£ç¡®ä½¿ç”¨è¿­ä»£å™¨åˆ é™¤å…ƒç´ â€ï¼Œæˆ‘é¢è¯•æ—¶ä½¿ç”¨çš„ä¹Ÿæ˜¯é‡Œé¢çš„æ–¹æ³•ï¼Œçœ‹é¢è¯•å®˜çš„ååº”å¥½åƒä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè¿˜é—®äº†æˆ‘ä¸€äº›æˆ‘æ—©å·²æ•´ç†è¿‡çš„è€ƒç‚¹ã€‚ä½†çœ‹åˆ°æ¡æ¬¾ 9 ä¹‹åï¼Œæˆ‘å°±è§‰å¾—è‡ªå·±ä»¥å‰å›ç­”å¾—æ²¡ä»€ä¹ˆæ°´å¹³äº†ã€‚

æ–‡æœ¬å‚è€ƒäº†æ¡æ¬¾ 9 å’Œæ¡æ¬¾ 32ã€‚

## remove()

`<algorithm>` ä¸­çš„ `remove()` çš„å£°æ˜ä¸ºï¼š

```c++
template<class ForwardIt, class T>
ForwardIt remove(ForwardIt first, ForwardIt last, const T& value);

```

ä¹Ÿå°±æ˜¯ä»èŒƒå›´ [first, last) å†…ç§»é™¤æ‰€æœ‰æ»¡è¶³ç‰¹å®šåˆ¤åˆ«æ ‡å‡†çš„å…ƒç´ ï¼Œå¹¶è¿”å›æ–°ç»“å°¾çš„å°¾åè¿­ä»£å™¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**`remove()` å¹¶ä¸çœŸæ­£åˆ é™¤ä¸œè¥¿ï¼Œå› ä¸ºå®ƒåšä¸åˆ°**ã€‚`remove()` ç§»åŠ¨æŒ‡å®šåŒºé—´ä¸­çš„æ‰€æœ‰å…ƒç´ ç›´åˆ°æ‰€æœ‰â€œä¸åˆ é™¤çš„â€å…ƒç´ åœ¨åŒºé—´çš„å¼€å¤´ï¼ˆç›¸å¯¹ä½ç½®å’ŒåŸæ¥çš„ä¸€æ ·ï¼‰ã€‚å®ƒè¿”å›ä¸€ä¸ªæŒ‡å‘æœ€åä¸€ä¸ªâ€œä¸åˆ é™¤çš„â€å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ çš„è¿­ä»£å™¨ã€‚è¿”å›å€¼æ˜¯åŒºé—´çš„â€œæ–°**é€»è¾‘**ç»ˆç‚¹â€ã€‚

```c++
vector<int> v;
v.reserver(10);
for(int i = 1; i <= 10; ++i)
{
    v.push_back(i);
}

v[3] = v[5] = v[9] = 99;
vecitor<int>::iterator newEnd(remove(v.begin(), v.end(), 99));

```

è°ƒç”¨ `remove()` ä¹‹å‰ï¼š

![è°ƒç”¨removeä¹‹å‰](https://gitee.com/tianshihao4944/gitee-images-bed/raw/master/20210205142005.png)

è°ƒç”¨ `remove()` ä¹‹åï¼š

![è°ƒç”¨removeä¹‹å](https://gitee.com/tianshihao4944/gitee-images-bed/raw/master/20210205142051.png)

## erase-remove æƒ¯ç”¨æ³•

å¦‚æœè¦çœŸæ­£åˆ é™¤ä¸œè¥¿çš„è¯ï¼Œåº”è¯¥åœ¨ `remove()` åé¢æ¥ä¸Š `erase()`ã€‚è¦ `erase()` çš„å…ƒç´ å¾ˆå®¹æ˜“è¯†åˆ«ï¼šå®ƒä»¬æ˜¯ä»åŒºé—´çš„â€œæ–°é€»è¾‘ç»ˆç‚¹â€å¼€å§‹æŒç»­åˆ°åŒºé—´çœŸæ­£é‡ç‚¹çš„åŸæ¥åŒºé—´çš„å…ƒç´ ã€‚è¦é™¤å»é‚£äº›å…ƒç´ ï¼Œè¦åšçš„äº‹æƒ…å°±æ˜¯ç”¨ä¸¤ä¸ªè¿­ä»£å™¨è°ƒç”¨ `erase()` çš„åŒºé—´å½¢å¼ã€‚

```c++
vector<int> v;
v.erase(remove(v.begin(), v.end(), 99), v.end());

```

æŠŠ `remove` çš„è¿”å›å€¼ä½œä¸º `erase()` åŒºé—´å½¢å¼ç¬¬ä¸€ä¸ªå®å‚ä¼ é€’å¾ˆå¸¸è§ï¼Œè¿™æ˜¯ä¸ªæƒ¯ç”¨æ³•ã€‚

## remove_if() å’Œ remove_copy_if()

### åºåˆ—å®¹å™¨

å¦‚æœè¦åˆ é™¤çš„ä¸æ˜¯æ¯ä¸ªæœ‰ç‰¹å®šå€¼çš„ç‰©ä½“ï¼Œè€Œæ˜¯æ¶ˆé™¤ä¸‹é¢çš„åˆ¤æ–­å¼

```c++
bool badValue(int x); // è¿”å› x æ˜¯å¦æ˜¯ "bad".

```

å¯¹äºåºåˆ—å®¹å™¨ï¼Œè¦åšçš„åªæ˜¯æŠŠæ¯ä¸ª `remove()` æ›¿æ¢æˆ `remove_if()`ï¼Œç„¶åå°±å®Œæˆäº†ï¼š

```c++
c.erase(remove_if(c.begin(), c.end(), badValue), c.end());

```

è¿™æ ·é¢è¯•é¢˜â€œä» `vector` ä¸­åˆ é™¤ 3 çš„å€æ•°â€å°±å˜å¾—æ›´ç®€å•äº†ï¼š

```c++
bool ThreeTimes(int num)
{
    return num % 3 == 0 ? true : false;
}

int main()
{
    // ...
    // ä¸€è¡Œä»£ç , æ²¡æœ‰å¾ªç¯.
    vec.erase(std::remove_if(vec.begin(), vec.end(), ThreeTimes), vec.end());
    // ...
}

```

çœŸæ˜¯å¥½ç¬‘ï¼Œå¬åˆ°é¢è¯•å®˜é—®æˆ‘è¿™é“é¢˜ï¼Œæˆ‘å¿ƒä¸­çªƒå–œï¼Œè¿˜æƒ³ç€ç§€ä¸€ç§€æˆ‘å…³äºâ€œå¦‚ä½•æ­£ç¡®ä½¿ç”¨è¿­ä»£å™¨åˆ é™¤å…ƒç´ â€çš„æ¸…æ™°æ€è·¯ï¼Œå“ˆå“ˆï¼ŒçœŸæ˜¯è´»ç¬‘å¤§æ–¹ ğŸ˜‚ã€‚

æ›´å®Œç¾çš„ç‰ˆæœ¬ï¼š

```c++
#include <algorithm>
#include <iostream>
#include <vector>
using namespace std;

int main()
{
    vector<int> vec{19, 21, 28, 13, 16, 2, 3, 29, 12,
                    4, 25, 17, 26, 5, 20, 18, 30, 6, 22,
                    11, 24, 14, 7, 23, 1, 15, 27, 8, 9, 10};

    // ä½¿ç”¨ lambda å‡½æ•°ä½œä¸ºè°“è¯. å½“ç„¶ -> bool å¯ä»¥çœç•¥.
    vec.erase(
        remove_if(vec.begin(),
                  vec.end(),
                  [&](int num) -> bool { return num % 3 == 0; }),
        vec.end());

    cout << "after erase-remove\n";
    cout << "size: " << vec.size() << "\n";
    cout << "capacity: " << vec.capacity() << "\n\n";

    // ä½¿ç”¨äº¤æ¢æŠ€å·§æ”¶ç¼©ç©ºé—´.
    vector<int>(vec).swap(vec);

    cout << "after swap trick\n";
    cout << "size: " << vec.size() << "\n";
    cout << "capacity: " << vec.capacity() << "\n";

    return 0;
}

```

è¾“å‡ºå¦‚ä¸‹ï¼š

```
after erase-remove
size: 20
capacity: 30

after swap trick
size: 20
capacity: 20

```

### å…³è”å®¹å™¨

å¯¹äºå…³è”å®¹å™¨ï¼Œ`remove_if()` ä¸æ˜¯å¾ˆç›´æˆªäº†å½“ã€‚æœ‰ä¸¤ç§æ–¹æ³•å¤„ç†è¯¥é—®é¢˜ï¼š

1. `remove_copy_if()`ï¼Œæ›´å®¹æ˜“ï¼Œæ•ˆç‡è¾ƒä½ï¼›
2. å¾ªç¯ï¼Œæ›´é«˜æ•ˆã€‚

å…³äº `remove_copy_if()`ï¼Œå®ƒ**æŠŠéœ€è¦çš„å€¼æ‹·è´åˆ°å¦ä¸€ä¸ªæ–°å®¹å™¨ä¸­**ï¼Œç„¶åæŠŠåŸå®¹å™¨çš„å†…å®¹å’Œæ–°çš„äº¤æ¢ï¼š

```c++
#include <algorithm>
#include <set>

bool ThreeTimes(int num)
{
    return num % 3 == 0 ? true : false;
}

int main()
{
    std::set<int> c{1, 2, 3, 4, 5, 6, 7, 8, 9, 10};
    std::set<int> notThreeTimes; // å­˜å‚¨é 3 çš„å€æ•°çš„ä¸´æ—¶å®¹å™¨.

    // ä» c å¤åˆ¶ä¸åˆ é™¤çš„å€¼åˆ° notThreeTimes.
    std::remove_copy_if(c.begin(), c.end(),
                        std::inserter(notThreeTimes, notThreeTimes.end()),
                        ThreeTimes);

    c.swap(notThreeTimes); // äº¤æ¢ c å’Œ notThreeTimes.

    return 0;
}

```

è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯å®ƒå¤åˆ¶äº†æ‰€æœ‰ä¸åˆ é™¤çš„å…ƒç´ ï¼Œè€Œè¿™æ ·çš„å¤åˆ¶å¼€é”€èŠ±è´¹å¾ˆå¤§ã€‚

`for` å¾ªç¯å¾ˆç®€å•ï¼Œæ³¨æ„ `erase()` æ—¶å¤„ç†å¥½è¿­ä»£å™¨å°±è¡Œï¼š

```c++
for(std::set<int>::iterator i = c.begin(); i != c.end();)
{
    if(ThreeTimes(*i))
    {
        // è¿˜å¯ä»¥å‘æ—¥å¿—æ–‡ä»¶ä¸­å†™å…¥ä¸€æ¡æ¶ˆæ¯.
        // logFile << "Erasing " << *i << '\n';
        c.erase(i++);
    }
    else
    {
        ++i;
    }
}

```

å½“ç„¶ï¼Œè¦æ˜¯åºåˆ—å®¹å™¨ä¹Ÿéœ€è¦åœ¨ `erase()` æ—¶æœ‰å…¶å®ƒæ“ä½œï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨ `for` å¾ªç¯ï¼Œåªéœ€æ³¨æ„åºåˆ—å¼å®¹å™¨ä½¿ç”¨è¿­ä»£å™¨åˆ é™¤å…ƒç´ çš„æŠ€å·§å°±è¡Œã€‚

## ç»“è®º

å»é™¤ä¸€ä¸ªå®¹å™¨ä¸­ç‰¹å®šå€¼çš„æ‰€æœ‰å¯¹è±¡ï¼š

1. å¦‚æœå®¹å™¨æ˜¯ `vector`ã€`stirng` æˆ– `deque`ï¼Œä½¿ç”¨ erase-remove æƒ¯ç”¨æ³•ï¼›
2. å¦‚æœå®¹å™¨æ˜¯ `list`ï¼Œä½¿ç”¨ `list::remove`ï¼›
3. å¦‚æœå®¹å™¨æ˜¯æ ‡å‡†å…³è”å®¹å™¨ï¼Œä½¿ç”¨å®ƒçš„ `erase()` æˆå‘˜å‡½æ•°ã€‚

å»é™¤ä¸€ä¸ªå®¹å™¨ä¸­æ»¡è¶³ä¸€ä¸ªç‰¹å®šåˆ¤å®šå¼çš„æ‰€æœ‰å¯¹è±¡ï¼š

1. å¦‚æœå®¹å™¨æ˜¯ `vector`ã€`string` æˆ– `deque`ï¼Œä½¿ç”¨ erase-remove_if æƒ¯ç”¨æ³•ï¼›
2. å¦‚æœå®¹å™¨æ˜¯ `list`ï¼Œä½¿ç”¨ `list::romove_if()`ï¼›
3. å¦‚æœå®¹å™¨æ˜¯æ ‡å‡†å…³è”å®¹å™¨ï¼Œä½¿ç”¨ `remove_copy_if()` å’Œ `swap()`ï¼Œæˆ–å†™ä¸€ä¸ªå¾ªç¯æ¥éå†å®¹å™¨å…ƒç´ ï¼Œä½†æŠŠè¿­ä»£å™¨ä¼ ç»™ `erase()` æ—¶è®°å¾—åç½®é€’å¢å®ƒã€‚

åœ¨å¾ªç¯å†…åšæŸäº›äº‹æƒ…ï¼ˆé™¤äº†åˆ é™¤å¯¹è±¡ä¹‹å¤–ï¼‰ï¼š

1. å¦‚æœå®¹å™¨æ˜¯æ ‡å‡†åºåˆ—å®¹å™¨ï¼Œå†™ä¸€ä¸ªå¾ªç¯æ¥éå†å…ƒç´ ï¼Œæ¯å½“è°ƒç”¨ `erase()` æ—¶è®°å¾—ç”¨å®ƒçš„è¿”å›å€¼æ›´æ–°è¿­ä»£å™¨ï¼›
2. å¦‚æœå®¹å™¨æ˜¯æ ‡å‡†å…³è”å®¹å™¨ï¼Œå†™ä¸€ä¸ªå¾ªç¯æ¥éå†å…ƒç´ ï¼Œå½“æŠŠè¿­ä»£å™¨ä¼ ç»™ `erase()` æ—¶è®°å¾—åç½®é€’å¢å®ƒã€‚
